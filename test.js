const Discord = require('discord.js');
const fs = require('fs');
const mmss = require('ms');
const client = new Discord.Client();
const prefix = '%'

client.on('ready', () => {
  console.log(`Welcome Bro ${client.user.tag}!`);
});

client.on('message', message => {
  if (!message.content.startsWith(prefix)) return;
  var args = message.content.split(' ').slice(1);
  var argresult = args.join(' ');
  if (message.author.id !== "476577762396864512") return;

  
  if (message.content.startsWith(prefix + 'setwatch')) {
  client.user.setActivity(argresult, {type: 'WATCHING'})
     console.log('test' + argresult);
    message.channel.sendMessage(`Watch Now: **${argresult}`)
} 

 
  if (message.content.startsWith(prefix + 'setlis')) {
  client.user.setActivity(argresult, {type: 'LISTENING'})
     console.log('test' + argresult);
    message.channel.sendMessage(`LISTENING Now: **${argresult}`)
} 


if (message.content.startsWith(prefix + 'setname')) {
  client.user.setUsername(argresult).then
      message.channel.sendMessage(`Username Changed To **${argresult}**`)
  return message.reply("You Can change the username 2 times per hour");
} 

if (message.content.startsWith(prefix + 'setavatar')) {
  client.user.setAvatar(argresult);
   message.channel.sendMessage(`Avatar Changed Successfully To **${argresult}**`);
}

if (message.content.startsWith(prefix + 'setT')) {
  client.user.setGame(argresult, "https://www.twitch.tv/peery13");
     console.log('test' + argresult);
    message.channel.sendMessage(`Streaming: **${argresult}`)
} 
if (message.content.startsWith(prefix + 'setgame')) {
  client.user.setGame(argresult);
     console.log('test' + argresult);
    message.channel.sendMessage(`Playing: **${argresult}`)
} 



});

client.on("message", message => {
    if (message.content.startsWith("%bc")) {
                 if (!message.member.hasPermission("ADMINISTRATOR"))  return;
  let args = message.content.split(" ").slice(1);
  var argresult = args.join(' ');
  message.guild.members.filter(m => m.presence.status !== 'all').forEach(m => {
  m.send(`${argresult}\n ${m}`);
  })
  message.channel.send(`\`${message.guild.members.filter( m => m.presence.status !== 'all').size}\`:mailbox:  Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙ„Ù…ÙŠÙ† `);
  message.delete();
  };
  });

client.on('message', message=> {
  if (message.author.bot) return;
  if (message.isMentioned(client.user))
  {
  message.reply(" Ø§Ù„Ø¨ÙˆØª Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„");
  }
});

client.on('message', message => {
 
  if (message.content === "%Ù‚ÙÙ„") {
                      if(!message.channel.guild) return message.reply(' This command only for servers');

if(!message.member.hasPermission('MANAGE_MESSAGES')) return message.reply(' Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª');
         message.channel.overwritePermissions(message.guild.id, {
       SEND_MESSAGES: false

         }).then(() => {
             message.reply("ØªÙ… ØªÙ‚ÙÙŠÙ„ Ø§Ù„Ø´Ø§Øª :white_check_mark: ")
         });
           }

if (message.content === "%Ø§ÙØªØ­") {
  if(!message.channel.guild) return message.reply(' This command only for servers');

if(!message.member.hasPermission('MANAGE_MESSAGES')) return message.reply('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª');
         message.channel.overwritePermissions(message.guild.id, {
       SEND_MESSAGES: true

         }).then(() => {
             message.reply("ØªÙ… ÙØªØ­ Ø§Ù„Ø´Ø§Øª:white_check_mark:")
         });
           }


});


const moment = require("moment")
client.on("guildMemberAdd", m => {
    if (datediff(parseDate(moment(m.user.createdTimestamp).format('l')), parseDate(moment().format('l'))) < 8) {
        m.ban();
    };
    function parseDate(str) {
        var mdy = str.split('/');
        return new Date(mdy[2], mdy[0]-1, mdy[1]);
    };
   
    function datediff(first, second) {
        return Math.round((second-first)/(1000*60*60*24));
    };
});

client.on('message', function(msg) {
  let verifLevels = ["None", "Low", "Medium", "(â•¯Â°â–¡Â°ï¼‰â•¯ï¸µ  â”»â”â”»", "â”»â”â”»ãƒŸãƒ½(à² ç›Šà² )ãƒå½¡â”»â”â”»"];
  let region = {
      "brazil": "Brazil",
      "eu-central": "Central Europe",
      "singapore": "Singapore",
      "Russia": "Russia",
      "us-central": "U.S. Central",
      "sydney": "Sydney",
      "us-east": "U.S. East",
      "us-south": "U.S. South",
      "us-west": "U.S. West",
      "eu-west": "Western Europe",
      "vip-us-east": "VIP U.S. East",
      "london": "London",
      "amsterdam": "Amsterdam",
      "hongkong": "Hong Kong"
  };
 
  if(msg.content.startsWith ('%server')) {
    let embed = new Discord.RichEmbed()
    .setColor('RANDOM')
    .setThumbnail(msg.guild.iconURL)
    .setTitle(`${msg.guild.name}`)
    .addField('**__ Server Name | Ø§Ø³Ù… Ø§Ù„Ø³ÙŠØ±ÙØ±__**',`[** __${msg.guild.name}__ **]`,true)
    .addField('**__ OwnerShip | Ø§Ù„Ø§ÙˆÙ†Ø± Ø§Ù„Ø§Ø³Ø§Ø³ÙŠ__**',`**${msg.guild.owner}**`,true)
    .addField('**__ Server ID | Ø§ÙŠØ¯ÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±__**',`**${msg.guild.id}**`,true)
    .addField('**__ Members Count | Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø¹Ø¶Ø§Ø¡__**',`[** __${msg.guild.memberCount}__ **]`,true)
    .addField('**__ Online | Ø§Ù„Ø§Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†__**',`[** __${msg.guild.members.filter(m=>m.presence.status == 'online').size}__ **]`,true)
    .addField('**__ Verification Level | Ù…Ø³ØªÙˆÙŠ Ø§Ù„Ø­Ù…Ø§ÙŠÙ‡__**',`[** __${verifLevels[msg.guild.verificationLevel]}__** ]`,true)
    .addField('**__ Region | Ø§Ù„Ø¨Ù„Ø¯__**',`[** __${region[msg.guild.region]}__** ]`,true)
    .addField('**__ Text Channels | Ø±ÙˆÙ…Ø§Øª ÙƒØªØ§Ø¨ÙŠÙ‡__**',`[** __${msg.guild.channels.filter(m => m.type === 'text').size}__** ]`,true)
    .addField('**__ Voice Channels | Ø±ÙˆÙ…Ø§Øª ØµÙˆØªÙŠÙ‡__**',`[** __${msg.guild.channels.filter(m => m.type === 'voice').size}__ **]`,true)
    .addField('**__ Created At | ØµÙ†Ø¹ ÙÙŠ __**',msg.guild.createdAt.toLocaleString())
    msg.channel.send({embed:embed});
  }
});

client.on('guildCreate', guild => {
  var embed = new Discord.RichEmbed()
  .setColor(0x5500ff)
  .setDescription(`**Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ù„Ø¥Ø¶Ø§ÙÙ‡ Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ù‰ Ø³ÙŠØ±ÙØ±Ùƒ**`)
      guild.owner.send(embed)
});


client.on('message', message => {
    var args = message.content.split(/[ ]+/)
    if(message.content.includes('discord.gg')){
        if(!message.channel.guild) return;
        message.delete()
    return message.reply(`** Ù…Ù…Ù†ÙˆØ¹ Ù†Ø´Ø± Ø³ÙŠØ±ÙØ±Ø§Øª Ø£Ø®Ø±Ù‰ ÙÙŠ Ø³ÙŠØ±ÙØ±Ù†Ø§ ! **`)
    }
});
 
 
client.on('message', message => {
    var args = message.content.split(/[ ]+/)
    if(message.content.includes('youtube.com')){
        if(!message.channel.guild) return;
        message.delete()
    return message.reply(`** Ù…Ù…Ù†ÙˆØ¹ Ø±ÙˆØ§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±! **`)
    }
});


client.on('guildMemberAdd', (member) => {
  member.addRole(member.guild.roles.find('name', 'not active'));
  });
   
   
  client.on('message', message => {                      
      if(!message.channel.guild) return;
         if(message.content.startsWith(prefix + 'active')) {
          let modlog = client.channels.find('name', 'ÙØ¹Ù„-Ù†ÙØ³Ùƒ');
         if(!message.channel.guild) return message.channel.send('**Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± ÙÙ‚Ø· Ù„Ù„Ø³ÙŠØ±ÙØ±Ø§Øª**').then(m => m.delete(5000));
         message.channel.sendMessage(`Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØµØ­ Ø¹Ø´Ø§Ù† ØªØªÙØ¹Ù„âœ…`).then(msg => {
         
         
          msg.react('âœ…')
         .then(() => msg.react('âœ…'))
       
       
   
         let activeFilter = (reaction, user) => reaction.emoji.name === 'âœ…' && user.id === message.author.id;
       
         let active = msg.createReactionCollector(activeFilter, { time: 15000 });
       
                                                         
                                 active.on("collect", r => {
                                     message.member.addRole(message.guild.roles.find("name", "Shark"));
                                     message.member.removeRole(message.guild.roles.find("name", "not active"));
                                     msg.delete();
                                     message.channel.send(`**ØªÙ… ØªÙØ¹ÙŠÙ„Ùƒ Ø§Ø³ØªÙ…ØªØ¹.**`).then(m => m.delete(1000));
       
                                     })
                                     })
                                     }
                                     });

client.on('guildMemberAdd', member => {
    let channel = member.guild.channels.find('name', 'chat');
    let memberavatar = member.user.avatarURL
      if (!channel) return;
    let embed = new Discord.RichEmbed()
        .setColor('PURPLE')
        .setThumbnail(memberavatar)
        .addField('ğŸ½ | name :  ',`${member}`)
        .addField('ğŸ“¢ | Ø§Ø·Ù„Ù‚ Ù…Ù† Ø¯Ø®Ù„' , `Welcome to the server, ${member}`)
        .addField('ğŸ†” | user :', "**[" + `${member.id}` + "]**" )
                .addField('â¡| Ø§Ù†Øª Ø§Ù„Ø¹Ø¶Ùˆ Ø±Ù‚Ù…',`${member.guild.memberCount}`)
               
    .addField('Ù…Ù† Ø·Ø±Ù :',`${inviter.id}`)
    
    .addField("Name:",`<@` + `${inviter.id}` + `>`, true)
    
                  .addField("Name:",`<@` + `${member.id}` + `>`, true)
                     
                                     .addField(' Ø§Ù„Ù€Ø³ÙŠØ±ÙØ±', `${member.guild.name}`,true)
                                       
     .setFooter(`${member.guild.name}`)
        .setTimestamp()
   
      channel.sendEmbed(embed);
    });
   

client.on('guildMemberAdd', member => { //LAST CODES -HONRAR-
  member.guild.fetchInvites().then(guildInvites => {
    const ei = invites[member.guild.id];
    const invite = guildInvites.find(i => ei.get(i.code).uses < i.uses);
    const inviter = client.users.get(invite.inviter.id);
    const stewart = member.guild.channels.find("name", "welcome");
     stewart.send(`<@${member.user.id}> ØªÙ…Øª Ø§Ù„Ø¯Ø¹ÙˆÙ‡ Ù…Ù† <@${inviter.id}>`);
   //  stewart.send(`<@${member.user.id}> joined using invite code ${invite.code} from <@${inviter.id}>. Invite was used ${invite.uses} times since its creation.`);
  });
})
 


client.login(process.env.BOT_TOKEN);
